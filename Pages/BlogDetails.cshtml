@page "/blog-detay/{slug}"
@inject Sitem.Web.Services.BlogService BlogService
@{
    Layout = "_RevizeLayout";
    var slug = RouteData.Values["slug"]?.ToString();
    var post = BlogService.GetPostBySlug(slug);

    if (post == null)
    {
        Response.Redirect("/blog");
        return;
    }

    ViewData["Title"] = post.Title;
    
    // Simple Next/Prev logic
    var allPosts = BlogService.GetAllPosts();
    var currentIdx = allPosts.FindIndex(p => p.Id == post.Id);
    var prevPost = currentIdx < allPosts.Count - 1 ? allPosts[currentIdx + 1] : null; // Descending order
    var nextPost = currentIdx > 0 ? allPosts[currentIdx - 1] : null;
}

@* Hero Section *@
<section class="relative w-full mb-12">
    <div class="hero-wrapper relative w-full h-[400px] lg:h-[500px] overflow-hidden border-b border-slate-200 dark:border-white/5 bg-slate-900">
         <div id="particles-js-blogdetail" class="absolute inset-0 z-20 pointer-events-none mix-blend-screen"></div>
        <div class="hero-slide active h-full w-full absolute inset-0 flex items-center justify-center text-center px-4">
             <div class="hero-bg absolute inset-0 bg-cover bg-center z-0" style="background-image: linear-gradient(135deg, rgba(10,16,32,0.85), rgba(13,31,74,0.75)), url('@post.ImageUrl');"></div>
             <div class="hero-content relative z-10 max-w-4xl mx-auto space-y-6">
                <div class="flex items-center justify-center gap-3">
                    <span class="px-3 py-1 rounded-full text-xs font-bold bg-blue-500/20 text-blue-200 border border-blue-500/30">@post.Category</span>
                    <span class="text-slate-300 text-xs">•</span>
                    <span class="text-slate-300 text-xs font-medium">@post.PublishDate.ToString("dd MMMM yyyy")</span>
                </div>
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-black text-white leading-tight">@post.Title</h1>
             </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        if(window.particlesJS) {
            particlesJS('particles-js-blogdetail', {
              "particles": { "number": { "value": 20, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.2, "random": false }, "size": { "value": 2, "random": false }, "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.1, "width": 1 }, "move": { "enable": true, "speed": 0.4, "direction": "right", "random": false, "straight": false, "out_mode": "out", "bounce": false } },
              "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } },
              "retina_detect": true
            });
        }
    </script>
}

<div class="px-4 md:px-10 py-10 max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        <!-- Article Content -->
        <div class="lg:col-span-8">
            <article class="prose prose-lg dark:prose-invert max-w-none">
                <p class="lead text-xl text-slate-600 dark:text-slate-300 font-medium leading-relaxed mb-8">
                    @post.Summary
                </p>
                
                @Html.Raw(post.Content)
            </article>

            <!-- Share -->
            <div class="mt-12 pt-8 border-t border-slate-200 dark:border-slate-800 flex items-center justify-between">
                <span class="font-bold text-slate-900 dark:text-white">Paylaş:</span>
                <div class="flex gap-4">
                    <button class="size-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-primary hover:text-white transition-all">
                        <span class="material-symbols-outlined text-lg">share</span>
                    </button>
                    <button class="size-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-[#0077b5] hover:text-white transition-all">
                        <span class="material-symbols-outlined text-lg">link</span>
                    </button>
                </div>
            </div>
            
            <!-- Navigation -->
            <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 gap-6">
                @if (prevPost != null)
                {
                    <a href="/blog-detay/@prevPost.Slug" class="group p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-primary/50 transition-all">
                        <span class="text-xs font-bold text-slate-400 mb-2 block uppercase tracking-wider">Önceki Yazı</span>
                        <h4 class="font-bold text-slate-900 dark:text-white group-hover:text-primary transition-colors">@prevPost.Title</h4>
                    </a>
                }
                else
                {
                    <div class="hidden sm:block"></div>
                }

                @if (nextPost != null)
                {
                    <a href="/blog-detay/@nextPost.Slug" class="group p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-primary/50 transition-all text-right">
                        <span class="text-xs font-bold text-slate-400 mb-2 block uppercase tracking-wider">Sonraki Yazı</span>
                        <h4 class="font-bold text-slate-900 dark:text-white group-hover:text-primary transition-colors">@nextPost.Title</h4>
                    </a>
                }
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-4 space-y-8">
            <!-- Author Card -->
            <div class="p-8 rounded-[2rem] bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 text-center">
                <div class="w-24 h-24 mx-auto rounded-full overflow-hidden mb-4 ring-4 ring-white dark:ring-slate-800 shadow-lg">
                    <img src="/logo/sitelogo.png" alt="Yazar" class="w-full h-full object-contain bg-white dark:bg-slate-950 p-2">
                </div>
                <h3 class="font-bold text-lg text-slate-900 dark:text-white">@post.Author</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mt-2">@post.Category Uzmanı</p>
            </div>
            
             <!-- Newsletter -->
            <div class="p-8 rounded-[2rem] bg-gradient-to-br from-primary to-blue-700 text-white shadow-xl shadow-primary/20">
                <span class="material-symbols-outlined text-4xl mb-4 bg-white/20 p-2 rounded-xl">mail</span>
                <h3 class="text-xl font-bold mb-2">Bültene Abone Olun</h3>
                <p class="text-blue-100 text-sm mb-6">En yeni teknik makaleler doğrudan posta kutunuza gelsin.</p>
                <form class="space-y-3">
                    <input type="email" placeholder="E-posta adresiniz" class="w-full rounded-xl border-0 bg-white/10 placeholder-blue-200 text-white focus:ring-2 focus:ring-white/50 text-sm py-3 px-4">
                    <button class="w-full py-3 bg-white text-primary font-bold rounded-xl hover:bg-blue-50 transition-colors">Abone Ol</button>
                </form>
            </div>
        </div>
    </div>
</div>
